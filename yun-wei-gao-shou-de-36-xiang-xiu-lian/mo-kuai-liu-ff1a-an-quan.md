# 第27课：应用安全：基于 HTTP、HTTPS 请求过程中常见 waf 攻防策略

上个课时讲解的 iptables 安全主要是4 层协议规则。除了 4 层安全外，7 层的安全攻击也是我们必须掌握的。那么在本课时我们基于 HTTP、HTTPS 请求过程中常见的安全防护问题来讲解 7 层应用安全。

# 常见的 7 层安全类攻击疑难点

对于 7 层安全攻击行为，作为运维工程师可能会遇到哪些痛点？

1.无法了解代码的逻辑，这种攻击更多贴合代码或者业务逻辑漏洞，由于我们很少能了解代码，所以很难定位到代码层次的具体问题。

2.黑客的攻击行为多样，7 层的攻击行为会非常多样，所以就运维来说我们可能需要提前储备多种防护技能。

## 常见 HTTP、HTTPS 攻击行为
本课时我们主要讲解 HTTP、HTTPS 协议的攻击行为，常见种类如下：

1.暴力破解，这里主要对弱口令漏洞来进行攻击；
2.HTTP 内容劫持；
3.CSRF 跨站请求伪造；
4.SQL 注入；
5.XSS 跨站脚本攻击，等等。

这都属于常见的 HTTP、HTTPS 请求类的攻击行为，我们将重点讲解其中的一些类型，并讲解一个运维工程师该如何去进行防范？

## 暴力破解及其防护策略
首先我们讲的是暴力破解攻击类型。暴力破解是指攻击者通过系统组合的所有可能性（网站登录时的账户、密码）尝试破解用户的账户名、密码等敏感信息。攻击者会经常使用自动化脚本或工具攻击，拿出正确的用户名和密码。它的特点有两个，一是会持续很长时间，因为要不断尝试多种用户名和密码组合；二是访问的次数会很多，因为访问的时间越长，那么它顺利破解可能性就会越大。 如果我们的用户名和密码口令设置得越弱，也就越容易被破解。

常见的暴力破解工具有以下几种：hydra、htpwdScan、Playload，你可以在网上查询下，其实都是通过海量的用户密码不断尝试后台访问。

对于这种攻击，我们应该从如下两个维度去防范：

运维工程师维度，需要对用户的后台，也就是我们常见的既有用户名密码的管理后台，或者是一些后台的登录接口添加一些安全策略，如：基于访问控制添加一个白名单访问，只允许某一个 IP 地址进行访问，这就大大减少了直接暴露后台接口，对所有公网都可以降低访问的隐患。

或者要限制用户的访问频率，不能让用户频繁地尝试登录后台，所以可以对这种攻击的过程进行频次的限制，这都是我们常会做的一些防范策略。

对于开发人员维度而言，首先需要把管理后台的密码设置得更加复杂，大小写字母加特殊字符加数字多种组合，让你的密码长度更长，这样尝试的时间周期就会更长，而且也越难进行破解。

第二就是设置一些密码校验失败的策略，比如同一个 IP，在单位时间限定其访问校验次数，如果超出了次数，就把基于 IP 或一些相关信息的后续访问限制，不让它频繁进行访问了，这也是可以在后台程序里实现的。

第三就是不使用用户密码的校验行为，加入一些更复杂的校验方式，如电子口令卡、动态密码等，这些都是非常有助于保护网站后台访问的，不至于把整个后台沦落到黑客手中。以上就是开发人员常常可以去做的一些防护的策略。

接下来为你举一个例子，我们以 Nginx 的设置为例，如果 Nginx 作为你公司服务架构的代理网关，那么在 Nginx 来做一些防范策略，具体包含： Nginx 实现管理后台的白名单控制，限流配置。