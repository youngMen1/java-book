# 第30课：k8s 主流网络方案（OVS、Flannel、Calico）及原理

## 容器间通信原理

我们知道 K8s 属于容器编排工具，了解K8s 网络其本质上需要了解容器间的网络互访原理。同宿主机上容器与容器通过 namespace 做网络隔离，使得每个容器由独立的网卡、回环设备以及监听的独立端口地址并不会相互影响。关于容器和容器之间的通信原理，我们就需要分两块来讲，一是同宿主机上，容器之间的通信过程，二就是不同宿主机上面，容器之间又是如何进行通信。

### 同宿主机上的容器通信原理

首先我们要来讲解的就是在同宿主机上的容器通信原理。 我们来看一下这样一张图：
Ciqc1F7h0CuAQKQLAACg7iAyYtk957.png

这张图里面同一台宿主机上面包含的两个容器，分别是 Docker01 和 Docker02，这两个容器都有自己的网卡设备，名称是 eth0 ，对应到宿主机上面，就有一个对应给到容器的虚拟网卡设备，对应的名称就是 Veth，后面加序列号的名称。容器一个对外通讯网络接口，那么通过什么来将它们整个串联起来呢，就是通过在宿主机下面搭建一个网桥的服务，使得在一台宿主机上面所有的容器进行内部的关联和通信，网桥相当于在宿主机上面起到一个二层虚拟交换机的作用。

### 不同宿主机上的容器通信原理
以上就是同一台宿主机上面容器之间进行通信的原理，不同宿主机上面容器又是如何通信的？ 对于不同主机上面的容器间通信主要有两种方式，第一种方式就是在三层网络上覆盖一层虚拟包头，如做对应的隧道，常见的有 VXLAN、GRE 等协议模式，都是利用了这样的原理。第二种方式就是通过路由的方式，修改路由表的信息，控制下一跳的 IP 地址来实现对应的功能。

首先我们来了解第一种方式的具体实现原理。要了解到主机之间的通信原理，我们可以先看一下这样的一张图：

Ciqc1F7h0DSACfq1AAF-K0jMyOw430.png