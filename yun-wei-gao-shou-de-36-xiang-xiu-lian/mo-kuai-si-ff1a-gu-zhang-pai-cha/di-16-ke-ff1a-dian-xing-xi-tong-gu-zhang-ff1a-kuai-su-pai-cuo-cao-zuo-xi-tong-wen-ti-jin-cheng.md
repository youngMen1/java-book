# 第16课：典型系统故障：快速排错操作系统问题进程

本课时我们开始学习“典型系统故障：快速排错操作系统问题进程 ”。



首先我将为你讲解常见问题进程的现象及影响，然后讲解如何通过一些命令和工具来分析这些问题进程。

## 常见进程问题及其对业务的影响

下面这张表格里面列出的是问题进程常见的一些类型。这个表格里一共有 6 个类型，前面 4 个类型可以总结为对资源使用过度，主要是 CPU、内存、 IO 以及对操作系统上文件句柄使用过度。这样的问题会影响到业务服务的稳定运行，同时可能会因为资源的占用，造成操作系统上面其他服务进程出现问题。

Ciqah16OzA-ASdUyAAQqyjnlKws003.png

造成问题的常见原因有很多：

1.由于外部请求或外部访问，超过了自身进程所能够承载的负荷，导致系统的资源消耗过多；

2.进程内部的问题，即进程的程序代码设计不合理，效率比较低，出现了资源分配不合理的地方，导致在自己的资源上消耗过多；

3.部署不合理，比如我们在部署的时候，两个进程抢占同一份资源；

4.安全性的问题，比如被攻击等。

接下来是第 2 类进程问题的类型：进程状态的问题。这里主要介绍两个我们运维会常见到的问题进程状态，一个是僵尸状态（Z），另外一个是进程不可中断的睡眠状态（D），这些都会导致自己业务服务出现问题。



这一类的问题通常是进程本身造成的，代码逻辑导致的情况居多。



以上就是我罗列的一些常见的进程问题类型，针对这些问题，接下来我罗列了一张表格，看看可以通过哪些命令来分析进程问题。

## 进程分析命令
Cgq2xl6OzA-AFspTAALINqZd-a8200.png

我们从上往下对这张表进行讲解：

* top 命令可以做到实时显示系统中各个进程的资源占用状况，后面是它的使用用例，如 top 或 top -p pid 对应的 pid 来展示某一个进程的使用状态。

* ps 命令，它也用来展示进程的状态，不过它是显示瞬间进程的状态 。我们可以通过 ps –ef、ps -aux 参数把某一个时态的操作系统的进程状态全部获取出来。

* strace 命令主要用来跟踪一个进程调用系统底层模块的过程，我们可以通过 strace+ 具体进程执行的命令，去跟踪对应进程对系统的调用。

* free 命令统计系统内存使用情况。

* iostat 主要用来监视操作系统上，磁盘操作的活动情况。

* vmstat 主要用来监控内存、进程、CPU 的活动状态。

* ldd 用来监控一个进程在启动运行时所需要的一些共享库。后面有一个用例，比如我们这里执行 ldd test 这个命令，那么它就会查看 test 进程在启用时，需要调用到操作系统的哪些共享库。

以上就是我们在分析问题进程时可能会经常用到的一些命令。接下来我们来讲讲，刚介绍的这些问题进程产生的原因是什么？以及我们具体应该通过什么样的方式去查看和分析这些问题进程？

##  问题进程排查方式

### 查找进程使用 CPU 资源过度
首先对于查找进程 CPU 资源使用过度的场景，这里最常用到的就是 top 命令。top 命令可以实时展示某一个进程或系统上所有进程的资源使用情况。可以在 Linux 操作系统上先输入 top 命令，如果我们需要去分析哪一个进程使用的资源更多，需要按对 CPU 的利用率由大到小进行排序，这时我们可以在执行 top 命令后，同时按住键盘上的“shift+p”键，就可以使进程对 CPU 的资源使用率这一列，按照从大到小来进行排序。

Ciqah16OzA-AfJyuAACkI-WSPd8875.png