# 第23课：操作系统紧急故障修复常见有效方案

你好，我是你的运维课老师 Jeson，本课时我们主要讲解操作系统故障时修复的常见有效方案。

通常操作系统遇到的一些灾难性故障，会导致操作系统无法正常运行、启动或是运维人员无法进行管理。我们想要学习解决操作系统的故障，就必须了解操作系统依赖的一些核心模块。

## 操作系统模块

![](/static/image/Ciqc1F66a-OAPlCNAAIm5pCaK9U962.jpg)

接下来，我们就先回顾操作系统在启动过程中需要依赖哪些核心模块，这里我以 Centos7 的操作系统为例进行讲解，如图所示。

图中由上到下列出了操作系统启动顺序，当我们打开计算机的电源开关后，计算机通电便会开始进入启动环节，首选会进入 BIOS，BIOS 的功能主要是为计算机提供最底层硬件设置和控制，并且加载 MBR。

MBR 是磁盘最前的一段引导代码，主要负责操作系统 对磁盘进行分区的合法判断，以及分区的引导信息定位，引导完成以后 MBR 接下来会交给操作系统的 GRUB2。

GRUB2 主要用于加载操作系统内核，如果你了解 Linux 就会比较清楚，我们可以在 GRUB2 的引导过程中来选择你想加载的操作系统内核选项，这里我们在作双系统场景需要通过 GRUB2 来设置 。

在 GRUB2 加载完操作系统内核后，便会进入操作系统内核的启动过程，操作系统内核启动过程主要是加载操作系统内核模块、驱动模块，等等。内核加载完毕后则正式交给操作系统的服务管理（systemd）来作服务加载，这样就完成了操作系统的启动过程。

## 常见错误

在操作系统的启动过程中，任何一个模块出现问题可能都会导致操作系统无法正常运行，运维人员无法进行管理的情况，那么通常会遇到哪些常见的问题呢？这里列举了运维常见的故障。

* fstab 错误
fstab 是作用在 /etc 下的文件，里面存放了操作系统的文件系统信息，我们在启动操作系统后需要挂载磁盘设备和分区，我们了解的 mount 挂载磁盘时的开机自动挂载方式就是通过 fstab 进行加载的。

通常情况，导致 fstab 常见的错误原因包括，比如在操作系统运行的过程中，把硬盘或存储给移除掉了，却没有及时修改更新 fstab 的设置；另外就是本身在配置 fstab 时就出现错误，在操作系统重启前没有及时进行更正。这些情况都可能导致操作系统启动时产生 fstab 错误。

* GRUB\MBR 损坏
刚讲的 Linux 启动过程中，GRUB\MBR 是系统启动必须经过的两个核心环节，而 GRUB\MBR也可能被异常损坏：比如我们在安装双系统的时候，由于后面安装的操作系统把前面操作系统的 MBR 给清理掉了，导致系统无法正常引导启动；第二种就是误删文件，我们在操作系统上把 GRUB 相关的文件进行了删除，这样就会导致操作系统无法读取到相关的配置，进而导致系统启动失败。

* 文件系统损坏
导致文件系统损坏一些常见场景，比如服务器正在运行时出现意外断电，导致文件系统出现损坏需要进行修复；或者磁盘等硬件故障也会导致文件系统损坏需要进行软件或硬件层的修复，这些都会导致操作系统文件系统损坏的情况。

* root 用户密码错误
root 用户密码错误是我们非常常见的错误，可能是由于忘记了 root 密码或是修改了 sshd 服务 相关配置，或是 password 文件出错，都可能导致无法通过 ssh 远程登录方式来管理操作系统。

以上这些情况都会导致管理员无法登录到操作系统上对问题进行修复，或者会导致操作系统长期维护上存在隐患。

## 操作系统特殊模式






