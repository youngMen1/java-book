# 第24课：Zabbix 自动发现和自动注册

这个课时我们来学习 Zabbix 自动发现和自动注册。

## Zabbix 及其优势介绍

你应该对 Zabbix 这个主流开源企业级监控系统并不陌生，它的官方网站是 [https://www.zabbix.com/。Zabbix](https://www.zabbix.com/。Zabbix) 具备如下几点特性：

1.你应该对 Zabbix 这个主流开源企业级监控系统并不陌生，它的官方网站是 [https://www.zabbix.com/。Zabbix](https://www.zabbix.com/。Zabbix) 具备如下几点特性：

2.功能丰富，具有图形化的界面展示，支持网络拓扑图示，同时也支持自定义面板。它还具备一套 CMDB功能（资产管理系统，可以对所有主机及硬件资产信息进行管理），支持数据聚合的分析方式。  
服务高可用性，Zabbix 支持 proxy 代理模式，所有的 客户端 节点汇报到 proxy 的代理中间节点，再统一上报到 server 节点，这样减少 zabbix\_server 节点的压力。另外 zabbix\_server 支持 ha 切换来作保证服务的高可用。

3.丰富的数据采集模式，Zabbix 有自己的 agent 用于数据采集，也支持一些公共的协议方式，如：SNMP、JMX 等。采集模式支持主动和被动模式（主动模式是指服务端能够主动向客户端抓取数据，被动模式是指客户端能向服务端上报数据）。它能够支持用户自定义方式编写插件（监控脚本、主机监控模版、主机组模版等）。Zabbix 提供一套完整的 API，可以方便地集成到企业内部 DevOps 或者是运维管理系统中。

除此之外，对于规模庞大的主机监控信息管理十分自动化，Zabbix 支持自动发现和自动注册功能，本课时我们会来具体讲解：

自动发现是指在服务端能够自动发现客户端的主机信息。这种机制我们在前面的课时 10 里有详细讲解过（通过 Django Python 开发一套自动发现资产信息的 CMDB 系统）。

Zabbix 的自动发现其实就是自动发现并自动添加监控客户端的主机及相关信息。它通过服务端来发起扫描，扫描局域内部的网络设备、服务器、主机等设备，收集这些设备的信息，添加设备固定的模板中，从发现-&gt;添加-&gt;配置-&gt;监控全面自动化实现，这就是自动发现的第 1 种模式。

第 2 个模式，Zabbix\_agent 主动注册，当 Zabbix\_agent 启动 agent 以后，会主动上报自己的主机信息给服务端，这样就可以实现主动上报并在服务端注册相关信息。

## Zabbix 服务端自动发现

首先我们来讲解 Zabbix 服务端自动发现，它的原理是这样的，首先扫描指定的 IP 地址段，匹配符合条件的主机，比如主机的类型，是否有 agent 等，如果满足条件就把设备信息录入。

接下来我们重点介绍 Zabbix 自动发现主机的设置步骤。主要有 2 个步骤：

* 首先设置好自动发现的规则，定义扫描的网段 IP 信息，然后定义自动扫描的时间间隔等。

* 当满足规则和条件以后，就需要配置好执行动作，配置执行动作可以添加主机，或者添加主机到某一个主机组或关联主机的模板等相关动作，都是在执行动作这里进行配置的。

接下来做一个演示，我这里拿两台主机，一台是服务端主机，作为 Zabbix\_server 来部署的，另外一台是客户端的主机，安装了 Zabbix\_agent，安装 Zabbix 时你可按照官方文档要求部署，并按其要求启用相应的服务。接下来就可以在控制台进行 Zabbix 具体配置了。

我们登录到 Zabbix 控制台，首先配置自动发现规则，我们按顺序点击 Configuration、Discovery 和 create Discovery rule，这就是配置的自动发现规则。



