# 第13课：网站割接必须掌握的 N 个检查项及命令

本课时，我们讲解网站割接过程中所需要掌握的一些常见的检查项及命令。

割接这个词起初来源于对于网络的一种操作，通常是对网络架构升级或者变更切换的操作。本课时我们说的网站割接表示对网站服务环境的切换和变更，网站割接是从运维的角度提出的，技术面涉及整个网站服务各项技术环节。

## 网路服务架构

我们来看这样一张图，在这张图里，右侧是基建部分，它包含如机房、服务器、风火水电、网络设备等。

![](/static/image/Ciqah16C0-yACkUdAAUn0Fjeq7k559.png)

除了基建部分外，我们可以看到这图中最下端一排是公共组件。比如服务器上运行操作系统，另外，也包含虚拟化内容，如：K8s 等都涵盖到这个公共基础组件中。

网站服务通常要对外提供服务，所以会用到 DNS 做域名解析，用 CDN 做静态元素的分发等。所以我将网站服务所需要依赖的公共组件，也罗列到了最下边的这个方框里面。

中间的三块组成，它们分别是入口层、逻辑层和数据层。

* 数据层会存储，包含：关系型数据库，非关系型数据库、大数据，或者对象存储等。

* 逻辑层与代码的关联更加紧密，比如代码依赖的公共组件、框架、服务等，还有代码本身，都在逻辑层里。

* 入口层涵盖了代理网关、4 层负载均衡、7 层负载均衡，等等。
如果以上任何一个部分做了相关的变动，都可能会涉及一次网站割接，而且需要去检查对应的割接检查项。

### 割接分类
我们再来具体介绍一下割接的分类。

网站服务内容可以分为同构割接和异构割接，如果是对同构的服务进行升级，就是同构割接，它的主体结构是不变的，只是进行例行性的升级，或者对它的代码版本等内容进行修改，比如我们用的 Nginx 服务，如果只是升级 Nginx 的版本，并没有把 Nginx 换成另外一个组件。异构割接则相反，当我们把网站服务的整个主体结构做了改变时，这种方式就是异构割接，如：你把网站入口网关 Nginx 改为 Apache，就属于异够割接。

如果根据割接的影响面来划分的话，可以分为局部割接和全局割接。在网站服务这张图里，如果我只操作了其中的一小部分，只对一小部分内容产生影响，则属于局部割接；全局性的割接则会影响你的整体功能，并会影响主要用户体验。

接下来，补充一个问题，需要注意这里我们讲的割接检查并不是故障检查，故障检查需要一步一步地分析问题，并且是在出现故障以后做的，它的排查思路更加聚焦在某一个问题。

而接下来我们要讲的割接检查，它的范围更广，需要检查范围也往往不限于一个小小的操作上，接下来我们具体讲解这部分。

### 割接检查分类

我们先给割接检查进行分类：
Cgq2xl6C0-yAfOVkAAVgPLjNgOE302.png

第 1 个类型是上层业务必须要检查的割接检测项。上层业务通常偏向于应用层。 涉及到图中的几个核心的层次，首先是入口层，它负责接收用户的请求。第 2 个是逻辑层，在这一层我们需要检查整体的逻辑是否正常执行。上层业务检查项还需要关注所依赖的公共组件，如 DNS、CDN 等。这一层检查流程不仅从一个运维角度检查也更模拟了一个真实用户检查。

Cgq2xl6C0-2AC5_TAAWGevLSJyA141.png

第 2 个重要类型就是数据层的割接检查。数据层更加关心数据层次中数据的完整性、数据库是否提供正常服务等相关内容。在图中我们看到，数据层既包含了数据库类型的服务，也包含了大数据和对象存储等服务，以关系数据库举例，我们最常用到的一个服务就是 MySQL，所以接下来我就为你讲解，当我们在做割接时，MySQL 数据库层里通常需要检查的一些内容。

学习本课时后面的内容，你需要了解 Linux 的一些基础操作和 MySQL 的一些基础知识。

### 常见割接项及命令

刚刚我们讲解到了两个主要割接检查项目的类别，下面我们围绕这两个类别，来具体讲解它有哪些割接项，以及在这个过程中具体用到的一些命令。

Cgq2xl6C0-2AIiQJAANXyFfWkc8409.png