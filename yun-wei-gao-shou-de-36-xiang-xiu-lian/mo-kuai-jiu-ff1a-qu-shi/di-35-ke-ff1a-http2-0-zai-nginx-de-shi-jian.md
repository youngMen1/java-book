# 第35课：HTTP2.0 在 Nginx 的实践

本课时讲解的内容是关于 HTTP2.0 在 Nginx 中的实践。我们会介绍 HTTP2.0 的协议，同时讲解 Nginx 是如何支持 HTTP2.0 特性作配置。

## 关于 HTTP 协议
在当前这个互联网时代，越来越多的应用场景使用 HTTP 协议（超文本传输协议），它是一个十分重要的协议。HTTP 当前主要使用的版本是 HTTP1.1，HTTP2.0 和 HTTP3.0，在这张图里我们先来整体了解下。

CgqCHl8hWe-ABsyqAABPxZNtCbI636.png

HTTP1.1 算是早期的版本了，如图所示它包含几大部分：HTTP 协议报文，底层 TCP 内容，还有 IP 及 MAC 这些内容。

在 HTTP1.1 协议里，最大的问题就是安全问题，因为它没法做到数据加密，为了解决这种数据安全性的问题，就引入了 HTTPS 协议。

HTTPS 对比 HTTP1.1 就是支持 SSL 数据加密并传送，这就解决了数据传输被劫持的问题。通过 HTTPS 做数据的加密和解密虽然解决了安全的问题，但造成性能损耗及增加多次客户端和服务端建连，所以性能造成了一定损耗，如何同时保障安全和性能更优呢？HTTP 协议本身的内容就有必要进行升级，也就接下来我们要讲的 HTTP2.0。

HTTP2.0 提出重要概念 Stream（流），将一个 TCP 连接分为若干个流（Stream），每个流中可以传输若干消息（Message），它是以流的方式进行数据包传输，通过建立 I/O 复用的机制来保障客户端连接和服务端请求响应的效率。

另外就是在压缩上的变化，它采用了 Hpark 机制进行头部压缩。而 HTTP1.1 协议是不做 HTTP 头信息的压缩的，HTTP2.0 则通过 Hpark 的方式进行了头部压缩，这样就减少了客户端和服务端传送的流量，并且 Hpark 在服务端建立起了一个字典，只以增量的方式传输投入的报文，所以整个这套机制改善了头部报文传送效率问题。

这就是 HTTP2.0 的协议最大的两个特性，而 HTTP3.0 的诞生解决了 HTTP2.0 一些缺陷，这些缺陷我们将在课程后面的内容为你介绍。

## HTTP2.0 协议
接下来我们要重点介绍的就是 HTTP2.0 协议。说首先来具体讲一讲 HTTP2.0 协议解决了 HTTP1.1 协议的哪些问题，也就是 HTTP1.1 协议里存在的劣势。

### HTTP1.1 的劣势
首先就是HTTP1.1性能问题。

第一表现是 TCP 连接存在请求阻塞的问题，因为一个连接同时只能处理一个请求，而浏览器又只能以先进先出的按照优先级的方式进行请求处理。所以如果一个响应没有及时返回时，后面的请求就都会阻塞。

为了优化请求阻塞的问题，很多技术人员开发前端架构会设计成多个域名，这样就可以让浏览器和服务端同时建立起多个连接。但是浏览器对于用 HTTP1.1 协议同时创建的连接个数是有限制的（不同浏览器限制个数不一样）。所以使用这种方式提高页面数据加载效率有限。

第二个问题就是内容的明文传输，我们刚刚讲过，HTTP1.1 协议对于数据内容是以明文的方式传输的，没有任何加密，所以容易出现内容被劫持。

###  HTTP2.0 的优势
HTTP1.1 这两点劣势在 HTTP2.0 都得到了很好的解决，接下来我们就介绍 HTTP2.0。

首先是 HTTP2.0 多路复用机制，所谓多路复用，就是在一个 TCP 连接里面，客户端可以通过 HTTP2.0 协议同时发送多个请求流，实现单连接上多请求 - 响应并行，这就解决了连接阻塞的问题，减少了 TCP 连接的数量和 TCP 连接慢的情况。

第二就是 HTTP2.0 用到了分帧二进制的方式进行传输，也就是在一个请求流中以数据帧作为传输的最小单位，实现二进制传输，并且基于 HTTPS 协议，解决明文传输安全性问题。

最后值得一提的就是服务端的主动推送机制，浏览器发送一个请求的时候，服务端会主动向浏览器推送与请求相关的资源，这个时候浏览器就不用再发起后续的请求了。