# 第31课：4、7 层入口负载均衡 SLB 如何作才是最佳姿势

本课时我们来学习 4/7 层入口负载均衡该如何进行设计。

## 负载均衡分类
讲到负载均衡 LB（全称：Load Balance），负载均衡实现了对海量请求、并发连接、数据传送等客户端相关内容均衡，使得这些流量和压力可以分摊到后台多个单元并行处理，这样就可以避免单个后台服务单元处理压力过大，另外也增强了整体服务的可用性。基于负载均衡功能覆盖在OSI 网络模型范围来划分，可以这样进行分类：

类型一：4 层负载均衡，它是基于传输层的底层的负载均衡方案，可以实现 TCP 连接层的会话保持等功能。

类型二：7 层应用层负载均衡，它可以实现更多针对特定协议应用，比如基于 HTTP 的应用负载均衡，就可以实现对 URL 的转发应用、HTTP 请求的处理，session 信息会话保持等。7 层负载均衡更加针对特定的应用协议，如对 HTTP 和 HTTPS 系统负载均衡的服务通常使用 Nginx、Haproxy 等开源 7 层负载均衡服务。

接下来通过对比做下总结，由于 4 层负载均衡更偏向底层能力的转发，所以它的负载性能相对更好，另外因为 4 层负载均衡偏向于底层的实现模式，所以上层的应用协议都是可以基于 4 层负载均衡转发的，所以 4 层负载均衡的应用范围更广。

而 7 层负载均衡服务针对某一类具体协议，在特定支持的应用协议上支持场景更丰富。

通常一个大门户网站企业，这两个类型负载均衡不是单独存在的，而是结合 4 层负载均衡特性和 7 层负载均衡的优势，整体设计一套高可用服务架构，这里以企业入口层负载均衡常用到的 4 层负载均衡 LVS 结合 Nginx + LUA 所实现 7 层负载均衡架构做一个介绍。

## 4/7 层入口负载均衡实现